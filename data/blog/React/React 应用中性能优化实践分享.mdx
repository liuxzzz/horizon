---
title: React åº”ç”¨ä¸­æ€§èƒ½ä¼˜åŒ–å®è·µåˆ†äº«ï¼ˆä¸€ï¼‰ ç†è®ºçŸ¥è¯†ç¯‡
date: '2025-10-11'
tags: ['React', 'Nextjs', 'Frontend','æ€§èƒ½ä¼˜åŒ–']
draft: false
---

## base 
https://www.developerway.com/posts/react-re-renders-guide

### Reactä¸­çš„é‡æ–°æ¸²æŸ“æ˜¯ä»€ä¹ˆï¼Ÿ

å½“è°ˆåˆ°Reactæ€§èƒ½æ—¶ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦é˜¶æ®µæˆ‘ä»¬éœ€è¦å…³æ³¨ï¼š
- **åˆå§‹æ¸²æŸ“** å‘ç”Ÿåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡è¢«æ¸²æŸ“çš„æ—¶å€™
- **é‡æ¸²æŸ“** é€šå¸¸å‘ç”Ÿåœ¨çŠ¶æ€å˜æ›´æ—¶

è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µéœ€è¦æåŠçš„å°±æ˜¯**å¿…è¦æ¸²æŸ“**å’Œ**ä¸å¿…è¦çš„æ¸²æŸ“**ã€‚

å¿…è¦æ¸²æŸ“å¯ä»¥ç†è§£ä¸ºçŠ¶æ€å˜æ›´åç»„ä»¶å¿…é¡»é‡æ–°æ¸²æŸ“å°†æ–°çš„æ•°æ®çŠ¶æ€æ›´æ–°åˆ°UIä¸Šï¼Œä¾‹å¦‚ä¸€ä¸ªinputç»„ä»¶åœ¨ç”¨æˆ·æŒ‰ä¸‹äº†å­—æ¯ä¹‹åï¼Œéœ€è¦å°†æŒ‰ä¸‹çš„å€¼æ›´æ–°åˆ°UIä¸Šï¼Œè€Œä¸å¿…è¦çš„æ¸²æŸ“åˆ™æ˜¯å¦‚æœæ¯æ¬¡æŒ‰é”®éƒ½æ¸²æŸ“äº†æ•´ä¸ªé¡µé¢ï¼Œåˆ™è¯¥é¡µé¢è¢«ä¸å¿…è¦åœ°é‡æ–°æ¸²æŸ“äº†ã€‚

ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“æœ¬èº«ä¸æ˜¯é—®é¢˜ï¼šReact éå¸¸å¿«ï¼Œé€šå¸¸èƒ½å¤Ÿåœ¨ç”¨æˆ·ä¸æ³¨æ„çš„æƒ…å†µä¸‹å¤„ç†å®ƒä»¬ã€‚

ä½†æ˜¯ï¼Œå¦‚æœé‡æ–°æ¸²æŸ“è¿‡äºé¢‘ç¹å’Œ/æˆ–åœ¨éå¸¸ç¹é‡çš„ç»„ä»¶ä¸Šè¿›è¡Œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ç”¨æˆ·ä½“éªŒæ˜¾å¾—â€œæ»åâ€ï¼Œæ¯æ¬¡äº¤äº’éƒ½ä¼šå‡ºç°æ˜æ˜¾çš„å»¶è¿Ÿï¼Œç”šè‡³åº”ç”¨ç¨‹åºå®Œå…¨æ²¡æœ‰å“åº”ã€‚è¿™é‡Œä¹Ÿæ˜¯æ€§èƒ½ä¼˜åŒ–çš„é‡ç¾åŒºã€‚

### React ç»„ä»¶ä½•æ—¶é‡æ–°æ¸²æŸ“è‡ªèº«ï¼Ÿ

ç»„ä»¶é‡æ–°æ¸²æŸ“çš„åŸå› æœ‰å››ç§ï¼š
1. çŠ¶æ€å˜åŒ– state changes 
2. çˆ¶çº§ï¼ˆæˆ–å­çº§ï¼‰é‡æ–°æ¸²æŸ“ parent (or children) re-renders
3. ä¸Šä¸‹æ–‡å˜åŒ– context changes
4. é’©å­å˜åŒ– hooks changes

ä¹Ÿå­˜åœ¨ä¸€ä¸ªå¤§çš„è¯¯åŒºï¼šè®¤ä¸ºç»„ä»¶çš„propså˜åŒ–æ—¶ä¼šå‘ç”Ÿé‡æ–°æ¸²æŸ“ã€‚æœ¬èº«æ¥è¯´ï¼Œè¿™å¹¶ä¸æ­£ç¡®ï¼ˆè§ä¸‹æ–‡è§£é‡Šï¼‰ã€‚

#### 1. Re-renders reason: state changes

å½“ç»„ä»¶ä¸­çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå‡ºå‘é‡æ–°æ¸²æŸ“ã€‚é€šå¸¸ä¼šå‘ç”Ÿåœ¨ useEffect ä¸­ï¼Œæˆ–è€…æ˜¯callback ä¸­ã€‚

State changes are the â€œrootâ€ source of all re-renders.

```
import { useState } from "react";
import "./styles.css";

const App = () => {
  const [state, setState] = useState(1);

  const onClick = () => {
    setState(state + 1);
  };

  console.log("Re-render number: ", state);

  return (
    <>
      <h2>Open console, click a button</h2>
      <p>Re-render because of state change should be logged on every click</p>
      <button onClick={onClick}>click here</button>
    </>
  );
};

export default App;
```




#### 2. Re-renders reason: çˆ¶ç»„ä»¶é‡æ¸²æŸ“

ä¸€ä¸ªç»„ä»¶å¦‚æœå…¶çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œå®ƒä¹Ÿä¼šé‡æ–°æ¸²æŸ“è‡ªå·±ã€‚æˆ–è€…ï¼Œå¦‚æœæˆ‘ä»¬ä»ç›¸åçš„æ–¹å‘æ¥çœ‹ï¼šå½“ä¸€ä¸ªç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œå®ƒä¹Ÿä¼šé‡æ–°æ¸²æŸ“æ‰€æœ‰å­ç»„ä»¶ã€‚

```
'use client'
import { useState } from "react";

export default function Home() {
  const [state, setState] = useState(1);

  const onClick = () => {
    setState(state + 1);
  };

  console.log("Re-render number: ", state);

  return (
    <>
      <h2>Open console, click a button</h2>
      <p>Re-render because of state change should be logged on every click</p>
      <button onClick={onClick}>click here</button>

      <Child />
    </>
  );
}
const Child = () => {
  console.log("Child re-renders");
  return <></>;
};


```


#### 3. Re-renders reason: context changes

å½“Context Providerä¸­çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä½¿ç”¨æ­¤Contextçš„ç»„ä»¶éƒ½å°†é‡æ–°æ¸²æŸ“ï¼Œå³ä½¿å®ƒä»¬æ²¡æœ‰ç›´æ¥ä½¿ç”¨å˜åŒ–çš„æ•°æ®éƒ¨åˆ†ã€‚

```
import { useState, createContext, useContext, useMemo, ReactNode } from "react";
import "./styles.css";

const Context = createContext<{ value: number }>({ value: 1 });

const Provider = ({ children }: { children: ReactNode }) => {
  const [state, setState] = useState(1);

  const onClick = () => {
    setState(state + 1);
  };

  const value = useMemo(
    () => ({
      value: state
    }),
    [state]
  );
  return (
    <Context.Provider value={value}>
      <button onClick={onClick}>click here</button>
      {children}
    </Context.Provider>
  );
};

const useValue = () => useContext(Context);

const Child1 = () => {
  const { value } = useValue();
  console.log("Child1 re-renders: ", value);
  return <></>;
};

const Child2 = () => {
  const { value } = useValue();
  console.log("Child2 re-renders", value);
  return <></>;
};

const App = () => {
  return (
    <Provider>
      <h2>Open console, click a button</h2>
      <p>Both children will re-render because of context</p>

      <Child1 />
      <Child2 />
    </Provider>
  );
};

export default App;

```


#### 4. Re-renders reason: hooks changes

é’©å­å†…éƒ¨å‘ç”Ÿçš„æ‰€æœ‰çŠ¶æ€å˜åŒ–éƒ½ä¼šè¢«ç»„ä»¶æ•æ‰

```
// è‡ªå®šä¹‰ hook
const useCounter = () => {
  const [count, setCount] = useState(0);
  
  const increment = () => setCount(prev => prev + 1);
  
  return { count, increment };
};

// ä½¿ç”¨è¯¥ hook çš„ç»„ä»¶
const MyComponent = () => {
  const { count, increment } = useCounter(); // hooks changes ä¼šè§¦å‘é‡æ¸²æŸ“
  
  console.log('Component re-renders because of hooks changes');
  
  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={increment}>Increment</button>
    </div>
  );
};
```

#### â›”ï¸ é‡æ–°æ¸²æŸ“åŸå› ï¼špropså˜åŒ–ï¼ˆå¤§è¯¯åŒºï¼‰
åœ¨è®¨è®ºæœªç¼“å­˜ç»„ä»¶çš„é‡æ–°æ¸²æŸ“æ—¶ï¼Œç»„ä»¶çš„propsæ˜¯å¦æ”¹å˜å¹¶ä¸é‡è¦ã€‚

ä¸ºäº†è®©propsæ”¹å˜ï¼Œå®ƒä»¬éœ€è¦ç”±çˆ¶ç»„ä»¶æ›´æ–°ã€‚è¿™æ„å‘³ç€çˆ¶ç»„ä»¶å°†éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œè¿™å°†è§¦å‘å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œæ— è®ºå…¶propså¦‚ä½•ã€‚
åªæœ‰åœ¨ä½¿ç”¨ç¼“å­˜æŠ€æœ¯ï¼ˆReact.memoï¼ŒuseMemoï¼‰æ—¶ï¼Œpropsçš„æ”¹å˜æ‰å˜å¾—é‡è¦ã€‚

æ— è®º props æ˜¯å¦å˜åŒ–ï¼Œå­ç»„ä»¶éƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼Œå› ä¸ºçˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“äº†ï¼

ğŸ¯ Props å˜åŒ–ä½•æ—¶é‡è¦ï¼Ÿ

Props å˜åŒ–åªåœ¨ä½¿ç”¨ç¼“å­˜æŠ€æœ¯æ—¶æ‰é‡è¦ï¼š

```javascript
const Parent = () => {
  const [count, setCount] = useState(0);
  
  return (
    <div>
      <button onClick={() => setCount(count + 1)}>ç‚¹å‡»: {count}</button>
      {/* props æ²¡æœ‰å˜åŒ–ï¼Œä½†å­ç»„ä»¶ä»ä¼šé‡æ–°æ¸²æŸ“ */}
      <Child name="å›ºå®šå€¼" />
    </div>
  );
};

const Child = ({ name }) => {
  console.log('Child é‡æ–°æ¸²æŸ“äº†ï¼props:', name);
  return <div>Hello {name}</div>;
};

// æ¯æ¬¡ç‚¹å‡»æŒ‰é’®ï¼ŒChild éƒ½ä¼šé‡æ–°æ¸²æŸ“
// å³ä½¿ name prop å§‹ç»ˆæ˜¯ "å›ºå®šå€¼"
// åŸå› ï¼šçˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ â†’ å­ç»„ä»¶é‡æ–°æ¸²æŸ“
```


#### â›”ï¸ åæ¨¡å¼ï¼šåœ¨æ¸²æŸ“å‡½æ•°ä¸­åˆ›å»ºç»„ä»¶

 ğŸ¤” ä»€ä¹ˆæ˜¯"åœ¨æ¸²æŸ“å‡½æ•°ä¸­åˆ›å»ºç»„ä»¶"ï¼Ÿ

é”™è¯¯åšæ³•ï¼š

```
const Parent = () => {
  const [count, setCount] = useState(0);
  
  // âŒ åæ¨¡å¼ï¼šåœ¨æ¸²æŸ“å‡½æ•°å†…éƒ¨å®šä¹‰ç»„ä»¶
  const BadChild = () => {
    const [childState, setChildState] = useState('hello');
    
    useEffect(() => {
      console.log('useEffect æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œï¼');
    }, []); // å³ä½¿ä¾èµ–æ•°ç»„ä¸ºç©º
    
    return (
      <div>
        <input value={childState} onChange={(e) => setChildState(e.target.value)} />
        <p>Count from parent: {count}</p>
      </div>
    );
  };
  
  return (
    <div>
      <button onClick={() => setCount(count + 1)}>Count: {count}</button>
      <BadChild /> {/* æ¯æ¬¡é‡æ¸²æŸ“éƒ½ä¼šé‡æ–°åˆ›å»ºï¼ */}
    </div>
  );
};
```

ğŸ”¥ ä¸ºä»€ä¹ˆè¿™æ˜¯æ€§èƒ½æ€æ‰‹ï¼Ÿ

1. åœ¨é‡æ¸²æŸ“æ—¶ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ–°ç»„ä»¶ï¼Œä¼šé”€æ¯æ—§ç»„ä»¶ï¼Œåˆ›å»ºå…¨æ–°çš„ç»„ä»¶ã€‚
2. ä¼šå¯¼è‡´çŠ¶æ€é‡ç½®ï¼Œç»„ä»¶è¢«é”€æ¯å’Œé‡å»ºè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°è§†è§‰é—ªçƒ


æ­£ç¡®åšæ³•æ˜¯å°†ç»„ä»¶å®šä¹‰ç§»åˆ°å¤–éƒ¨ã€‚



#### âœ… Preventing re-renders with composition: children as props

è¿™ä¹Ÿå¯ä»¥ç§°ä¸ºâ€œå°†çŠ¶æ€åŒ…è£¹åœ¨å­å…ƒç´ å‘¨å›´â€ã€‚è¿™ç§æ¨¡å¼ç±»ä¼¼äºâ€œçŠ¶æ€å‘ä¸‹ç§»åŠ¨â€ï¼šå®ƒåœ¨ä¸€ä¸ªè¾ƒå°çš„ç»„ä»¶ä¸­å°è£…çŠ¶æ€å˜åŒ–ã€‚è¿™é‡Œçš„åŒºåˆ«åœ¨äºï¼ŒçŠ¶æ€è¢«ç”¨äºåŒ…è£¹æ¸²æŸ“æ ‘ä¸­è¾ƒæ…¢éƒ¨åˆ†çš„å…ƒç´ ä¸Šï¼Œå› æ­¤å®ƒä¸èƒ½é‚£ä¹ˆå®¹æ˜“åœ°è¢«æå–ã€‚ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯åœ¨ç»„ä»¶çš„æ ¹å…ƒç´ ä¸Šé™„åŠ çš„onScrollæˆ–onMouseMoveå›è°ƒã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒçŠ¶æ€ç®¡ç†å’Œä½¿ç”¨è¯¥çŠ¶æ€çš„éƒ¨åˆ†å¯ä»¥æå–åˆ°ä¸€ä¸ªæ›´å°çš„ç»„ä»¶ä¸­ï¼Œå¹¶å°†æ…¢é€Ÿç»„ä»¶ä½œä¸ºå­ç»„ä»¶ä¼ é€’ç»™å®ƒã€‚ä»æ›´å°çš„ç»„ä»¶çš„è§’åº¦æ¥çœ‹ï¼Œå­ç»„ä»¶åªæ˜¯å±æ€§ï¼Œå› æ­¤å®ƒä»¬ä¸ä¼šå—åˆ°çŠ¶æ€å˜åŒ–çš„å½±å“ï¼Œå› æ­¤ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚


âœ… Preventing re-renders with composition: components as props

è¿™ä¸ªæ¨¡å¼ä¸ "children as props" ç±»ä¼¼ï¼Œä½†é€‚ç”¨äºéœ€è¦å°†**ç‹¬ç«‹ç»„ä»¶**åˆ†åˆ«ä¼ å…¥ä¸åŒä½ç½®çš„åœºæ™¯ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼šå°†çŠ¶æ€ç®¡ç†å°è£…åœ¨å°ç»„ä»¶ä¸­ï¼Œé‡å‹ç»„ä»¶ä½œä¸º props ä¼ å…¥ï¼Œé¿å…å› çŠ¶æ€å˜åŒ–è€Œé‡æ¸²æŸ“ã€‚

**é€‚ç”¨åœºæ™¯**ï¼šå½“å‡ ä¸ªé‡å‹ç»„ä»¶ç‹¬ç«‹äºçŠ¶æ€å˜åŒ–ï¼Œä½†ä¸èƒ½ä½œä¸ºæ•´ä½“æå–æ—¶ã€‚

```javascript
// âŒ é—®é¢˜ï¼šæ‰€æœ‰ç»„ä»¶éƒ½ä¼šå› ä¸º notifications æ›´æ–°è€Œé‡æ¸²æŸ“
const Dashboard = () => {
  const [notifications, setNotifications] = useState([]);
  
  useEffect(() => {
    const interval = setInterval(() => {
      setNotifications(prev => [...prev, `æ–°é€šçŸ¥ ${Date.now()}`]);
    }, 1000);
    return () => clearInterval(interval);
  }, []);
  
  return (
    <div>
      <ExpensiveHeader />      {/* ä¼šé‡æ¸²æŸ“ */}
      <ExpensiveSidebar />     {/* ä¼šé‡æ¸²æŸ“ */}
      <ExpensiveContent />     {/* ä¼šé‡æ¸²æŸ“ */}
      <NotificationCenter notifications={notifications} />
    </div>
  );
};

// âœ… è§£å†³æ–¹æ¡ˆï¼šç»„ä»¶ä½œä¸º props ä¼ å…¥
const DashboardLayout = ({ header, sidebar, content }) => {
  const [notifications, setNotifications] = useState([]);
  
  useEffect(() => {
    const interval = setInterval(() => {
      setNotifications(prev => [...prev, `æ–°é€šçŸ¥ ${Date.now()}`]);
    }, 1000);
    return () => clearInterval(interval);
  }, []);
  
  return (
    <div>
      {header}    {/* ä¸ä¼šé‡æ¸²æŸ“ */}
      {sidebar}   {/* ä¸ä¼šé‡æ¸²æŸ“ */}
      {content}   {/* ä¸ä¼šé‡æ¸²æŸ“ */}
      <NotificationCenter notifications={notifications} />
    </div>
  );
};

// ä½¿ç”¨æ—¶
const Dashboard = () => (
  <DashboardLayout
    header={<ExpensiveHeader />}
    sidebar={<ExpensiveSidebar />}
    content={<ExpensiveContent />}
  />
);
```

**å…³é”®ç‚¹**ï¼šä½œä¸º props ä¼ å…¥çš„ç»„ä»¶ä¸ä¼šå› ä¸º `DashboardLayout` å†…éƒ¨çŠ¶æ€å˜åŒ–è€Œé‡æ–°æ¸²æŸ“ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨çˆ¶ç»„ä»¶ä¸­åˆ›å»ºçš„ã€‚




#### Preventing re-renders with React.memo

åœ¨React.memoä¸­åŒ…è£¹ä¸€ä¸ªç»„ä»¶å°†é˜»æ­¢ç”±æ¸²æŸ“æ ‘ä¸Šæ¸¸æŸå¤„è§¦å‘çš„é‡æ–°æ¸²æŸ“é“¾ï¼Œé™¤éæ­¤ç»„ä»¶çš„å±æ€§å·²æ›´æ”¹ã€‚

å½“æ¸²æŸ“ä¸€ä¸ªä¸ä¾èµ–äºé‡æ–°æ¸²æŸ“æ¥æºï¼ˆå³çŠ¶æ€ã€æ›´æ”¹çš„æ•°æ®ï¼‰çš„é‡é‡çº§ç»„ä»¶æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚

#### âœ… React.memo: component with props

æ‰€æœ‰éåŸå§‹å€¼çš„ props éƒ½å¿…é¡»è¢«è®°å¿†åŒ–ï¼ŒReact.memo æ‰èƒ½æ­£å¸¸å·¥ä½œ